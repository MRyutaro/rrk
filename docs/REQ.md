# 概要
**rrk**（rireki）は、Go製の単一バイナリCLIツールで、bash/zshのシェル履歴を  
- **セッション**・**ディレクトリ**単位で論理的にグループ化  
- 過去のコマンドを「**そのまま再実行可能**」な形で抽出し、簡単に呼び出せる履歴管理を提供  

といった形で管理・検索・再実行を支援します。

# 背景
- 標準のbash/zsh履歴は全履歴を一元化しており、特定セッションや作業ディレクトリに絞り込めない  
- プロジェクト移行やディレクトリ構成変更時に履歴中の`cd /old/path`がエラーになるなど、過去コマンドの再利用に手間がかかる  
- Atuinやfzf-historyなど多くのツールが「検索性」や「同期機能」に注力する一方、**再実行性の手軽さ**や**論理グループ化**まで踏み込んだ支援機能は未実装  
- サーバ用途でも使いやすいよう、「依存ライブラリ不要」「単一バイナリ配布」「初回対話セットアップ」で非エキスパートでも導入可能なCLIツールが求められている  

# 機能要件

## 1. 論理グループ化

1. **セッション単位**  
   - `rrk session list`  
     ︙過去のセッションID一覧を表示  
   - `rrk session show current` または `rrk s show`  
     ︙現在のシェルセッションの履歴のみを表示  
   - `rrk s show <SESSION_ID>`  
     ︙任意のセッション履歴を一発で抽出  

2. **ディレクトリ単位**  
   - `rrk cwd show` または `rrk d show`  
     ︙今いるディレクトリの履歴を即表示  
   - `rrk d show /path/to/dir`  
     ︙指定ディレクトリ配下の履歴を表示  
   - `rrk cwd list`  
     ︙履歴を記録しているディレクトリ一覧を確認  

## 2. 再実行サポートコマンド

- `rrk rerun <HIST_ID>`  
  └ 指定した履歴エントリを `cd /dir && command` の形で即時再実行する  
  └ 実際に保存される履歴は `command` のみで、`cd` 部分は保存されない  

# 履歴保存仕様

- 履歴データは `~/rrk/` ディレクトリ以下に保存  
- 保存形式はパフォーマンスを最優先し、ファイルベースのプレーンテキストまたは高速なバイナリ形式（要検討）  
- 各履歴エントリは以下の情報を保持：
  - `id`: 自動採番される一意な整数（1から順に付番）  
  - `session_id`: 同一セッションを示す文字列（UUIDなど）  
  - `cwd`: 実行時のカレントディレクトリ（パス）  
  - `command`: 実行されたコマンド（cd除く）

# 非機能要件

- **データベース不要**
  - SQLiteやBoltDB等の外部データベースは使用せず、軽量な独自ファイルフォーマットで管理  
- **クロスプラットフォーム**
  - Linux / macOS / Windows（WSL含む）のbash・zshで動作検証  
- **インストール容易性**
  - 単一静的リンクバイナリの配布。`curl` や `brew` / `apt` 等でも配布可能にする予定  
- **低オーバーヘッド**
  - 履歴取得は非同期または簡易なファイル追記形式で、シェル起動や実行パフォーマンスに影響を与えない  
- **ヘルプ・マニュアル充実**
  - `rrk --help`, `rrk <subcommand> --help` で全オプション解説  
  - `man rrk` を用意し、インストール時に配置されるよう設計  
  - 初回起動時には対話型のチュートリアル表示あり（スキップ可能）  
