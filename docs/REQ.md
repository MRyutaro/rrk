# 概要
**rrk**（rireki）は、Go製の単一バイナリCLIツールで、シェル履歴をディレクトリごとにツリー形式で表示する履歴可視化ツールです。

主な機能：
- ディレクトリツリー形式でコマンド履歴を表示
- 各ディレクトリでどんなコマンドを実行したかを一目で確認
- pstree風の視覚的な表示

# 背景
- 標準のbash/zsh履歴は全履歴を一元化しており、特定ディレクトリでの作業内容を把握しにくい
- プロジェクトごと、ディレクトリごとにどんなコマンドを実行したかを視覚的に確認したい
- ディレクトリ構造と実行コマンドの関係を直感的に理解できるツールが必要

# 実装機能

## 基本コマンド

### 履歴ツリー表示
- `rrk tree` - ディレクトリツリー形式で履歴を表示
- `rrk tree /path` - 指定パス以下のツリーを表示
- `rrk tree -n 5` - 各ディレクトリで最新5件のコマンドを表示

### セットアップ・管理
- `rrk setup` - シェル統合の自動セットアップ
- `rrk uninstall` - アンインストール
- `rrk version` - バージョン情報

## シェル統合

### 自動履歴記録
- bash/zsh対応のフック機能で自動履歴記録
- `~/.bashrc`/`~/.zshrc`への統合設定追加
- 非同期処理でシェルパフォーマンスへの影響を最小化

# 履歴保存仕様

## データ保存先
- 履歴データは `~/.rrk/` ディレクトリ以下に保存（隠しディレクトリ）
- `~/.rrk/history.jsonl` - JSONL形式での履歴保存
- `~/.rrk/current_session` - 現在のセッションID
- `~/.rrk/hook.sh` - シェル統合スクリプト

## 履歴エントリ構造
各履歴エントリは以下の情報を保持：
- `id`: 自動採番される一意な整数（1から順に付番）
- `session_id`: 同一セッションを示す文字列（ホスト名_PID_タイムスタンプ）
- `cwd`: 実行時のカレントディレクトリ（パス）
- `command`: 実行されたコマンド（cdコマンドは記録対象外）
- `timestamp`: 実行時刻（RFC3339形式）

# 表示例

```
$ rrk tree
/home/user
├── project/
│   ├── git status
│   ├── git add .
│   └── git commit -m "fix bug"
├── scripts/
│   ├── ./deploy.sh
│   └── python backup.py
└── .config/
    └── vim init.vim

/var
└── log/
    ├── tail -f syslog
    ├── grep ERROR *.log
    └── journalctl -u nginx
```

# CI/CD・リリース自動化

## GitHub Actions
- **PR→mainマージ時**: 自動パッチバージョンアップ + リリース作成
- **手動タグプッシュ時**: リリース作成
- **マルチプラットフォームビルド**: Linux/macOS/Windows (AMD64/ARM64)

## バージョン管理
- セマンティックバージョニング
- `make patch/minor/major` - ローカルでのバージョンアップ
- `scripts/bump-version.sh` - バージョン管理スクリプト

## ワークフロー構成
- `.github/workflows/auto-patch.yml` - PRマージ時の自動パッチリリース
- `.github/workflows/release-on-tag.yml` - タグプッシュ時のリリース
- `.github/workflows/release.yml` - 共通リリース処理（再利用可能）

# 技術仕様

## 非機能要件
- ✅ **データベース不要** - JSONL形式でのファイルベース管理
- ✅ **クロスプラットフォーム** - Linux/macOS/Windows対応
- ✅ **単一バイナリ** - Go製静的リンクバイナリ
- ✅ **低オーバーヘッド** - 非同期履歴記録
- ✅ **自動アップデート** - GitHub Releasesからの自動更新
- ✅ **ヘルプ充実** - 全コマンドでhelp対応
- ✅ **クリーンアンインストール** - データ削除機能付き

## 開発環境
- **言語**: Go 1.22+
- **依存**: cobra（CLI）、標準ライブラリのみ
- **ビルド**: Makefile + GitHub Actions
- **配布**: GitHub Releases

## アーキテクチャ
```
rrk/
├── main.go              # エントリーポイント
├── cmd/                 # CLI コマンド実装
│   ├── root.go         # ルートコマンド
│   ├── tree.go         # ツリー表示
│   ├── setup.go        # セットアップ
│   ├── uninstall.go    # アンインストール
│   └── version.go      # バージョン情報
├── internal/           # 内部ライブラリ
│   ├── history/        # 履歴エントリ定義
│   ├── storage/        # ストレージ操作
│   ├── session/        # セッション管理
│   └── tree/           # ツリー表示ロジック
└── scripts/            # ビルドスクリプト
    └── bump-version.sh # バージョン管理
```

# 設計原則

## ユーザビリティ
- **シンプルな機能**: `rrk tree`に特化した明確な価値提供
- **視覚的な理解**: ディレクトリ構造とコマンド履歴の関係を直感的に表示
- **最小限の学習コスト**: 複雑なオプションを排除した設計

## 保守性
- **機能の集約**: 単一機能への集中による保守性向上
- **モジュール化**: ツリー表示ロジックの独立性確保
- **テスト可能性**: シンプルな機能による単体テスト容易性

## 拡張性
- **プラグイン対応**: 将来的な表示形式拡張への対応
- **設定可能性**: ツリー表示のカスタマイズサポート
- **API設計**: ツリー生成ロジックの再利用性確保